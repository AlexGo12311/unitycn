<!DOCTYPE html>
<html>
<head>
    <title>{{.title}}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background: #f9f9f9;
        }

        .user-info {
            background: #fff;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #ddd;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .user-info-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-info-right {
            display: flex;
            gap: 15px;
        }
        
        .admin-link {
            color: #d32f2f;
            font-weight: bold;
            text-decoration: none;
            padding: 5px 10px;
            border: 1px solid #d32f2f;
            border-radius: 4px;
        }
        
        .admin-link:hover {
            background: #d32f2f;
            color: white;
        }
        
        .auth-link {
            color: #1976d2;
            text-decoration: none;
            padding: 5px 10px;
            border: 1px solid #1976d2;
            border-radius: 4px;
        }
        
        .auth-link:hover {
            background: #1976d2;
            color: white;
        }
        
        .user-role {
            background: #1976d2;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .user-role.admin {
            background: #d32f2f;
        }
        
        .logout-link {
            color: #666;
            text-decoration: none;
            padding: 5px 10px;
            border: 1px solid #666;
            border-radius: 4px;
        }
        
        .logout-link:hover {
            background: #666;
            color: white;
        }

        .post {
            border: 1px solid #ccc;
            padding: 15px;
            margin: 10px 0;
            background: white;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .slogan {
            color: #d32f2f;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            font-size: 1.5em;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
        }

        .like-btn {
            background: #f0f0f0;
            border: 1px solid #ccc;
            padding: 5px 10px;
            cursor: pointer;
            margin-left: 10px;
            border-radius: 4px;
        }

        .like-btn:hover {
            background: #e0e0e0;
        }

        .like-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .timestamp {
            color: #666;
            font-size: 0.9em;
            margin-left: 10px;
        }

        .post-author {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }

        .user-id {
            color: #999;
            font-size: 0.8em;
        }

        .post-content {
            margin: 10px 0;
            line-height: 1.5;
            font-size: 1.1em;
        }

        #post-form {
            background: white;
            padding: 20px;
            border-radius: 4px;
            border: 1px solid #ddd;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        #post-form button {
            background: #d32f2f;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
            border-radius: 4px;
            font-weight: bold;
            width: 100%;
        }
        
        #post-form button:hover {
            background: #b71c1c;
        }
        
        #post-form input {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            margin-bottom: 10px;
        }

        .post-stats {
            display: flex;
            gap: 15px;
            margin: 10px 0;
            color: #666;
            font-size: 0.9em;
        }

        .post-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .post-actions button {
            background: #f0f0f0;
            border: 1px solid #ccc;
            padding: 5px 15px;
            cursor: pointer;
            border-radius: 4px;
        }

        .post-actions button:hover {
            background: #e0e0e0;
        }

        .comments-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .add-comment {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .add-comment textarea {
            flex: 1;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-family: inherit;
            resize: vertical;
            min-height: 60px;
        }

        .add-comment button {
            background: #1976d2;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            align-self: flex-start;
        }

        .add-comment button:hover {
            background: #1565c0;
        }

        .comment {
            padding: 10px;
            background: #f9f9f9;
            border-radius: 4px;
            margin-bottom: 8px;
            border-left: 3px solid #1976d2;
        }

        .comment-author {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .comment-content {
            margin: 5px 0;
            line-height: 1.4;
        }

        .comment-date {
            font-size: 0.8em;
            color: #888;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .heroes-section {
            background: white;
            padding: 20px;
            border-radius: 4px;
            border: 1px solid #ddd;
            margin: 30px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .heroes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .hero-card {
            border: 1px solid #eee;
            padding: 15px;
            border-radius: 4px;
            text-align: center;
        }

        .hero-card img {
            max-width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .hero-card h4 {
            margin: 10px 0 5px 0;
            color: #333;
        }

        .hero-card p {
            color: #666;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .post-form-note {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
            text-align: center;
        }

        .post-form-note a {
            color: #1976d2;
            text-decoration: none;
        }

        .post-form-note a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>{{.title}}</h1>
        <h2 class="slogan">{{.slogan}}</h2>
        
        <!-- –ë–ª–æ–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
        <div class="user-info">
            <div class="user-info-left">
                <strong>–¢–æ–≤–∞—Ä–∏—â:</strong> 
                {{if .user}}
                    <span>{{.user.Username}}</span>
                    <span class="user-role {{if eq .user.Role "admin"}}admin{{end}}">
                        {{if eq .user.Role "admin"}}–ê–¥–º–∏–Ω{{else}}–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å{{end}}
                    </span>
                {{else}}
                    <span style="color: #999;">–ì–æ—Å—Ç—å</span>
                {{end}}
            </div>
            
            <div class="user-info-right">
                {{if .user}}
                    {{if eq .user.Role "admin"}}
                        <a href="/admin" class="admin-link">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>
                    {{end}}
                    <a href="/logout" onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã?')" class="logout-link">–í—ã–π—Ç–∏</a>
                {{else}}
                    <a href="/login" class="auth-link">–í–æ–π—Ç–∏</a>
                    <a href="/register" class="auth-link">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                {{end}}
            </div>
        </div>

        <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞ -->
        <div id="post-form">
            <input type="text" id="post-content" placeholder="–¢–æ–≤–∞—Ä–∏—â, –ø–æ–¥–µ–ª–∏—Ç–µ—Å—å –º—ã—Å–ª—è–º–∏...">
            {{if .user}}
                <button onclick="createPost()">ÂèëÂ∏É (–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å)</button>
            {{else}}
                <button onclick="window.location.href='/login'" style="background: #666;">
                    –í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å
                </button>
                <p class="post-form-note">
                    –ß—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç, <a href="/login">–≤–æ–π–¥–∏—Ç–µ</a> –∏–ª–∏ <a href="/register">–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å</a>
                </p>
            {{end}}
        </div>

        <!-- –°–µ–∫—Ü–∏—è –≥–µ—Ä–æ–µ–≤ -->
        {{if .heroes}}
        <div class="heroes-section">
            <h3>–ì–µ—Ä–æ–∏ –ø—Ä–æ–ª–µ—Ç–∞—Ä–∏–∞—Ç–∞:</h3>
            <div class="heroes-grid">
                {{range .heroes}}
                <div class="hero-card">
                    {{if .ImageURL}}
                        <img src="{{.ImageURL}}" alt="{{.Name}}">
                    {{else}}
                        <div style="height: 120px; background: #eee; display: flex; align-items: center; justify-content: center; border-radius: 4px; color: #999;">
                            –ù–µ—Ç —Ñ–æ—Ç–æ
                        </div>
                    {{end}}
                    <h4>{{.Name}}</h4>
                    <p>{{.Description}}</p>
                    <small>{{.BirthDate.Format "02.01.2006"}}</small>
                </div>
                {{end}}
            </div>
        </div>
        {{end}}

        <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ—Å—Ç—ã -->
        <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ—Å—Ç—ã:</h3>
        <div id="posts-container">
            {{if .posts}}
                {{range .posts}}
                <div class="post" id="post-{{.ID}}">
                    <div class="post-author">
                        <strong>
                            {{if .User}}
                                {{if .User.DisplayName}}
                                    {{.User.DisplayName}}
                                {{else}}
                                    {{.User.Username}}
                                {{end}}
                            {{else}}
                                –ê–Ω–æ–Ω–∏–º
                            {{end}}
                        </strong>
                        <small class="user-id">ID: {{.UserID}}</small>
                    </div>

                    <div class="post-content">{{.Content}}</div>

                    <div class="post-stats">
                        <span>üëç <span id="likes-{{.ID}}">{{.Likes}}</span></span>
                        <span class="timestamp">{{.CreatedAt.Format "02.01.2006 15:04"}}</span>
                    </div>

                    <div class="post-actions">
                        <button class="like-btn" data-post-id="{{.ID}}" onclick="likePost({{.ID}})">
                            –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å
                        </button>
                        <button class="comment-btn" onclick="toggleComments({{.ID}})">
                            –û—Ç–≤–µ—Ç–∏—Ç—å
                        </button>
                    </div>

                    <!-- –°–µ–∫—Ü–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
                    <div class="comments-section" id="comments-{{.ID}}" style="display: none;">
                        <div class="add-comment">
                            <textarea id="comment-input-{{.ID}}" placeholder="–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." rows="2"></textarea>
                            <button onclick="addComment({{.ID}})">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                        </div>
                        <div class="comments-list" id="comments-list-{{.ID}}">
                            <div>–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤...</div>
                        </div>
                    </div>
                </div>
                {{end}}
            {{else}}
                <p style="text-align: center; color: #666; padding: 20px;">
                    –ü–æ–∫–∞ –Ω–µ—Ç –ø–æ—Å—Ç–æ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!
                </p>
            {{end}}
        </div>
    </div>

<script>
    // ========== –û–ë–©–ò–ï –§–£–ù–ö–¶–ò–ò ==========
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫—É–∫–∏
    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
        return null;
    }

    // –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    function clearAuth() {
        localStorage.removeItem('token');
        localStorage.removeItem('user');
        document.cookie = "token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
    }

    // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
    function getAuthToken() {
        // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è API)
        let token = localStorage.getItem('token');
        
        // 2. –ï—Å–ª–∏ –Ω–µ—Ç, –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫—É–∫–∏
        if (!token) {
            token = getCookie('token');
            if (token) {
                // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –≤ localStorage –¥–ª—è API
                localStorage.setItem('token', token);
            }
        }
        
        return token;
    }

    // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
    
    document.addEventListener('DOMContentLoaded', function() {
        updateAuthInfo();
    });

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    function updateAuthInfo() {
        const token = getAuthToken();
        
        if (token) {
            try {
                const payload = JSON.parse(atob(token.split('.')[1]));
                console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:', payload.username);
            } catch (e) {
                console.log('–û—à–∏–±–∫–∞ —Ç–æ–∫–µ–Ω–∞:', e);
                clearAuth();
            }
        }
    }

    // ========== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ==========
    
    // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
// –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
function logout() {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
        // 1. –û—á–∏—â–∞–µ–º localStorage
        localStorage.removeItem('token');
        
        // 2. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∫—É–∫–∏
        fetch('/logout')
            .then(response => {
                // 3. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
                window.location.href = '/';
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ:', error);
                window.location.href = '/';
            });
    }
}

    // ========== –ü–û–°–¢–´ ==========
    
    // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞
    async function createPost() {
        const content = document.getElementById('post-content').value.trim();
        const token = getAuthToken(); // –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é

        if (!token) {
            alert('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É!');
            window.location.href = '/login';
            return;
        }

        if (!content) {
            alert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–∞!');
            return;
        }

        const button = event.target;
        const originalText = button.textContent;
        button.textContent = '–ü—É–±–ª–∏–∫–∞—Ü–∏—è...';
        button.disabled = true;

        try {
            const response = await fetch('/api/posts', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + token
                },
                body: JSON.stringify({ content: content })
            });

            if (response.ok) {
                document.getElementById('post-content').value = '';
                location.reload();
            } else {
                const error = await response.json();
                alert('–û—à–∏–±–∫–∞: ' + (error.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
            }
        } catch (error) {
            alert('–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: ' + error.message);
        } finally {
            button.textContent = originalText;
            button.disabled = false;
        }
    }

    // –õ–∞–π–∫ –ø–æ—Å—Ç–∞
    async function likePost(postId) {
        const token = getAuthToken(); // –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
        if (!token) {
            alert('–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã —Å—Ç–∞–≤–∏—Ç—å –ª–∞–π–∫–∏!');
            window.location.href = '/login';
            return;
        }

        const button = document.querySelector(`[data-post-id="${postId}"]`);
        const originalText = button.textContent;
        button.disabled = true;
        button.textContent = '...';

        try {
            const response = await fetch(`/api/posts/${postId}/like`, {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            });

            if (response.ok) {
                const result = await response.json();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ª–∞–π–∫–æ–≤
                const likesSpan = document.getElementById(`likes-${postId}`);
                if (likesSpan) {
                    const currentLikes = parseInt(likesSpan.textContent) || 0;
                    likesSpan.textContent = result.liked ? currentLikes + 1 : currentLikes - 1;
                }
                
                // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
                button.textContent = result.liked ? 'üëç –ü–æ–¥–¥–µ—Ä–∂–∞–Ω–æ' : '–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å';
                setTimeout(() => {
                    button.textContent = originalText;
                    button.disabled = false;
                }, 1000);
            } else {
                const error = await response.json();
                alert('–û—à–∏–±–∫–∞: ' + (error.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                button.textContent = originalText;
                button.disabled = false;
            }
        } catch (error) {
            alert('–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞');
            button.textContent = originalText;
            button.disabled = false;
        }
    }

    // ========== –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò ==========
    
    // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
    function toggleComments(postId) {
        const commentsSection = document.getElementById(`comments-${postId}`);
        const button = event.target;
        
        if (commentsSection.style.display === 'none') {
            commentsSection.style.display = 'block';
            button.textContent = '–°–∫—Ä—ã—Ç—å';
            loadComments(postId);
        } else {
            commentsSection.style.display = 'none';
            button.textContent = '–û—Ç–≤–µ—Ç–∏—Ç—å';
        }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
    async function loadComments(postId) {
        const commentsList = document.getElementById(`comments-list-${postId}`);
        
        if (!commentsList) return;
        
        commentsList.innerHTML = '<div style="color: #666; text-align: center;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
        
        try {
            const response = await fetch(`/api/posts/${postId}/comments`);
            
            if (response.ok) {
                const comments = await response.json();
                
                if (!comments || comments.length === 0) {
                    commentsList.innerHTML = '<div style="color: #666; text-align: center;">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</div>';
                } else {
                    let html = '';
                    comments.forEach(comment => {
                        const userName = comment.user ? 
                            (comment.user.display_name || comment.user.username || '–ê–Ω–æ–Ω–∏–º') : 
                            '–ê–Ω–æ–Ω–∏–º';
                        const date = new Date(comment.created_at).toLocaleString('ru-RU', {
                            day: '2-digit',
                            month: '2-digit',
                            year: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                        
                        html += `
                        <div class="comment">
                            <div class="comment-author">${userName}</div>
                            <div class="comment-content">${comment.content}</div>
                            <div class="comment-date">${date}</div>
                        </div>`;
                    });
                    commentsList.innerHTML = html;
                }
            } else {
                commentsList.innerHTML = '<div style="color: #666; text-align: center;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
            }
        } catch (error) {
            commentsList.innerHTML = '<div style="color: #666; text-align: center;">–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞</div>';
        }
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
    async function addComment(postId) {
        const token = getAuthToken(); // –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
        if (!token) {
            alert('–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å!');
            window.location.href = '/login';
            return;
        }
        
        const input = document.getElementById(`comment-input-${postId}`);
        const content = input.value.trim();
        
        if (!content) {
            alert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è!');
            return;
        }
        
        const button = event.target;
        const originalText = button.textContent;
        button.disabled = true;
        button.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';
        
        try {
            const response = await fetch(`/api/posts/${postId}/comments`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + token
                },
                body: JSON.stringify({ content: content })
            });
            
            if (response.ok) {
                input.value = '';
                button.textContent = '‚úì –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ';
                setTimeout(() => {
                    button.textContent = originalText;
                    button.disabled = false;
                    loadComments(postId);
                }, 1000);
            } else {
                const error = await response.json();
                alert('–û—à–∏–±–∫–∞: ' + (error.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                button.textContent = originalText;
                button.disabled = false;
            }
        } catch (error) {
            alert('–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞');
            button.textContent = originalText;
            button.disabled = false;
        }
    }
</script>

</body>
</html>