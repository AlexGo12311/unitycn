<!DOCTYPE html>
<html>
<head>
    <title>–í—Ö–æ–¥ - –ï–¥–∏–Ω—Å—Ç–≤–æ Âõ¢Áªì</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 400px; margin: 50px auto; }
        form { display: flex; flex-direction: column; gap: 10px; }
        input, button { padding: 10px; font-size: 16px; }
        .login-btn { 
            background: #d32f2f; 
            color: white; 
            border: none; 
            cursor: pointer; 
        }
        .register-btn { 
            background: #1976d2; 
            color: white; 
            border: none; 
            cursor: pointer;
            padding: 10px;
            margin-top: 10px;
            width: 100%;
        }
        .link-btn {
            background: none;
            border: none;
            color: #1976d2;
            cursor: pointer;
            text-decoration: underline;
            padding: 0;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h1>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h1>
    <p>–î–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ—Å—Ç–æ–≤ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</p>
    
    <form id="login-form">
        <input type="text" id="username" placeholder="–õ–æ–≥–∏–Ω" required>
        <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" required>
        <button type="submit" class="login-btn">–í–æ–π—Ç–∏</button>
    </form>
    
    <div style="margin-top: 20px; text-align: center;">
        <p>–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? 
            <a href="/register" style="color: #1976d2; text-decoration: none;">
                <strong>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</strong>
            </a>
        </p>
        
        <div style="margin: 15px 0; border-top: 1px solid #eee; padding-top: 15px;">
            <p style="color: #666; font-size: 0.9em;">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:</p>
            <button onclick="registerTestUser()" class="link-btn">
                –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            </button>
        </div>
        
        <a href="/" style="color: #666; text-decoration: none; font-size: 0.9em;">
            ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
        </a>
    </div>
    
    <script>
    document.getElementById('login-form').onsubmit = async function(e) {
        e.preventDefault();
        
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        const submitBtn = document.querySelector('.login-btn');
        const originalText = submitBtn.textContent;
        submitBtn.textContent = '–í—Ö–æ–¥...';
        submitBtn.disabled = true;
        
        try {
            const response = await fetch('/api/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            });
            
            if (response.ok) {
                const data = await response.json();
                localStorage.setItem('token', data.token);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—à–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                submitBtn.textContent = '–£—Å–ø–µ—à–Ω–æ!';
                submitBtn.style.backgroundColor = '#388e3c';
                
                setTimeout(() => {
                    window.location.href = '/';
                }, 500);
            } else {
                const error = await response.json();
                alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + (error.error || '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å'));
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        } catch (error) {
            alert('–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.');
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
        }
    };
    
    async function registerTestUser() {
        const username = 'comrade_' + Math.floor(Math.random() * 1000);
        const password = 'proletariat123';
        
        if (!confirm(`–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?\n–õ–æ–≥–∏–Ω: ${username}\n–ü–∞—Ä–æ–ª—å: ${password}`)) {
            return;
        }
        
        try {
            const response = await fetch('/api/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    username: username, 
                    password: password,
                    display_name: '–¢–æ–≤–∞—Ä–∏—â ' + Math.floor(Math.random() * 100)
                })
            });
            
            if (response.ok) {
                alert(`–¢–æ–≤–∞—Ä–∏—â —Å–æ–∑–¥–∞–Ω! üö©\n–õ–æ–≥–∏–Ω: ${username}\n–ü–∞—Ä–æ–ª—å: ${password}\n\n–¢–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏.`);
                document.getElementById('username').value = username;
                document.getElementById('password').value = password;
            } else {
                const error = await response.json();
                alert('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ' + (error.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
            }
        } catch (error) {
            alert('–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
        }
    }
    
    // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ)
    document.addEventListener('DOMContentLoaded', function() {
        // –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ localStorage
        const testUser = localStorage.getItem('test_user');
        if (testUser) {
            const user = JSON.parse(testUser);
            document.getElementById('username').value = user.username;
            document.getElementById('password').value = user.password;
        }
    });
    </script>
</body>
</html>