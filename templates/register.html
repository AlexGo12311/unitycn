<!DOCTYPE html>
<html>
<head>
    <title>Регистрация - Единство 团结</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 400px; margin: 50px auto; }
        form { display: flex; flex-direction: column; gap: 10px; }
        input, button { padding: 10px; font-size: 16px; }
        button { background: #d32f2f; color: white; border: none; cursor: pointer; }
        .form-group { display: flex; flex-direction: column; }
        label { margin-bottom: 5px; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Регистрация</h1>
    <p>Создайте аккаунт для публикации постов</p>
    
    <form id="register-form">
        <div class="form-group">
            <label for="username">Логин *</label>
            <input type="text" id="username" placeholder="Для входа в систему" required>
        </div>
        
        <div class="form-group">
            <label for="display_name">Никнейм</label>
            <input type="text" id="display_name" placeholder="Как вас будут видеть другие">
            <small>Если не указать, будет использован логин</small>
        </div>
        
        <div class="form-group">
            <label for="password">Пароль *</label>
            <input type="password" id="password" required>
        </div>
        
        <div class="form-group">
            <label for="password_confirm">Подтверждение пароля *</label>
            <input type="password" id="password_confirm" required>
        </div>
        
        <button type="submit">Зарегистрироваться</button>
    </form>
    
    <p style="margin-top: 20px;">
        Уже есть аккаунт? <a href="/login">Войти</a><br>
        <a href="/">На главную</a>
    </p>
    
    <script>
    document.getElementById('register-form').onsubmit = async function(e) {
        e.preventDefault();
        
        const username = document.getElementById('username').value;
        const displayName = document.getElementById('display_name').value;
        const password = document.getElementById('password').value;
        const passwordConfirm = document.getElementById('password_confirm').value;
        
        if (password !== passwordConfirm) {
            alert('Пароли не совпадают!');
            return;
        }
        
        const response = await fetch('/api/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                username: username,
                display_name: displayName || '',
                password: password 
            })
        });
        
        if (response.ok) {
            alert('Регистрация успешна! Теперь войдите в систему.');
            window.location.href = '/login';
        } else {
            const error = await response.json();
            alert(error.error || 'Ошибка регистрации');
        }
    };
    </script>
</body>
</html>